{% extends 'alimentation/base.html' %}
{% load static %}
{% block contenue %}
{% block formulaire %}
<form method="POST" class="row">
    {% csrf_token %}
    <div class="col-md-9 col-sm-12 "}>
        <select name="ajouter-aliment" id="select-aliment" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
                {% for aliment in liste_aliments %}
                <option value="{{aliment.id}}">{{aliment.nom}}</option>
                {% endfor %}    
        </select>
    </div>
    <div class="col-md-3 col-sm-12 mb-3">
        {% for aliment in liste_aliments %}
        {% if aliment.id == 1 %}
        <a  href="{% url 'alimentation:detail' aliment.id %}" id="aliment_{{aliment.id}}" class="btn btn-primary btn-info-alimentation btn-lg visible" target="out_blank"type="submit"><i class="bi bi-info-circle"></i></a>
        {% else %}
        <a  href="{% url 'alimentation:detail' aliment.id %}" id="aliment_{{aliment.id}}"class="btn btn-primary btn-lg btn-info-alimentation visually-hidden" target="out_blank" type="submit"><i class="bi bi-info-circle"></i></a>
        {% endif %}
        {% endfor %}    
        <button class="btn btn-primary btn-lg" type="submit"><i class="bi bi-calendar-plus"></i></button>
    </div>
</form>
{% endblock formulaire %}
<div class="row">
    <div class="col-md-12">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th scope="col">aliment</th>
                    <th scope="col">calorie</th>
                    <th scope="col">lipides</th> 
                    <th scope="col">cholestérol</th> 
                    <th scope="col">protéines</th> 
                    <th scope="col">potassium</th> 
                    <th scope="col">glucides</th> 
                </tr>
            </thead>
            <tbody>
                {% for object in liste_consomation %}
                <tr>
                    <td scope="col">{{object.aliment.nom}}</td>
                    <td scope="col">{{object.aliment.calorie|floatformat}}</td>
                    <td scope="col">{{object.aliment.lipides|floatformat}}</td> 
                    <td scope="col">{{object.aliment.cholestérol|floatformat}}</td> 
                    <td scope="col">{{object.aliment.protéines|floatformat}}</td> 
                    <td scope="col">{{object.aliment.potassium|floatformat}}</td> 
                    <td scope="col">{{object.aliment.glucides|floatformat}}</td> 
                    {% block btn_effacer_tab %}<td><a href="{% url 'alimentation:delete' object.id %}" class="btn btn-outline-danger"><i class="bi bi-trash"></i></button></td>{% endblock btn_effacer_tab %}
                </tr>
                {% endfor %}
                <tr>
                    <td scope="col">Totale : {{liste_totale.aliment__nom__count |floatformat}}</td>
                    <td scope="col">{{liste_totale.aliment__calorie__sum |floatformat}}</td>
                    <td scope="col">{{liste_totale.aliment__lipides__sum |floatformat}}</td> 
                    <td scope="col">{{liste_totale.aliment__cholestérol__sum |floatformat}}</td> 
                    <td scope="col">{{liste_totale.aliment__protéines__sum |floatformat}}</td> 
                    <td scope="col">{{liste_totale.aliment__potassium__sum |floatformat}}</td> 
                    <td scope="col">{{liste_totale.aliment__glucides__sum |floatformat}}</td> 
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="row">
    <div class="col-md-5 mx-auto">
        <canvas id="myChart"></canvas>
    </div>
</div>
<div class="row">
    <div class="col">
        <canvas id="pourcentageBar"></canvas>
    </div>
</div>

{% endblock  %}
{% block body %}
<script>
liste_aliment = document.getElementById("select-aliment")
if(liste_aliment){
   liste_aliment.onchange = function() {changerBouttonInfo()};
}

function changerBouttonInfo() {
    var id_aliment = document.getElementById("select-aliment").value;
    var ancien_boutton = document.getElementsByClassName("btn-info-alimentation visible");
    ancien_boutton[0].classList.add("visually-hidden");
    ancien_boutton[0].classList.remove("visible");
    var nouveau_boutton = document.getElementById("aliment_"+id_aliment);
    nouveau_boutton.classList.remove("visually-hidden");
    nouveau_boutton.classList.add("visible");
}
    const data_totale = {
        labels: [
          'Lipides',
          'Cholestérol',
          'Protéines',
          'Potassium ',
          'Glucides'
        ],
        datasets: [{
          label: 'Valeur energetique',
          data: [{{liste_totale.aliment__lipides__sum|escapejs}},{{liste_totale.aliment__cholestérol__sum|escapejs}},{{liste_totale.aliment__protéines__sum|escapejs}},{{liste_totale.aliment__potassium__sum|escapejs}},{{liste_totale.aliment__glucides__sum|escapejs}}],
          backgroundColor: [
            'rgb(241, 196, 15)',
            'rgb(183, 149, 11)',
            'rgb(255, 0, 0 )',
            'rgb(198, 230, 236)',
            'rgb(255, 146, 0)'
          ],
          hoverOffset: 4
        }]
      };
    const data_pourcentage = {
    labels:  [
          'Lipides',
          'Cholestérol',
          'Protéines',
          'Potassium ',
          'Glucides'
        ],
    datasets: [{
        label: 'Pourcentage %',
        data: {{liste_pourcentage|escapejs}},
        backgroundColor: [
        'rgba(255, 99, 132, 0.2)',
        'rgba(255, 159, 64, 0.2)',
        'rgba(255, 205, 86, 0.2)',
        'rgba(75, 192, 192, 0.2)',
        'rgba(54, 162, 235, 0.2)'
        ],
        borderColor: [
        'rgb(255, 99, 132)',
        'rgb(255, 159, 64)',
        'rgb(255, 205, 86)',
        'rgb(75, 192, 192)',
        'rgb(54, 162, 235)'
        ],
        borderWidth: 1
    }]
    };
    var ctx = document.getElementById('myChart'); 
    var myChart = new Chart(ctx, {
        type: 'pie',
        data: data_totale,
    });
    var cpourcentage = document.getElementById('pourcentageBar'); 
    var pourcentageBar = new Chart(cpourcentage, {
        type: 'bar',
        data: data_pourcentage,
        options: {
            scales: {
            y: {
                beginAtZero: true
            }
            }
        },
        });
</script>
{% endblock  %}